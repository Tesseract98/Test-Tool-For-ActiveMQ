# TestToolForActiveMQ
Задание
MQ Loader - тестовый инструмент, генерирующий поток сообщений для тестируемой системы, которая получает сообщения через очередь ActiveMQ.
Программа должна запускаться из командной строки. Необходимые для работы программы настройки будут храниться в текстовом файле. Можно использовать формат Properties.
Сообщения, которые должна генерировать программа, имеют текстовый формат. Пользователь описывает сообщение с помощью шаблона. Этот файл содержит текст сообщения с формулами для генерации значений полей. Для вычисления формул должна использоваться библиотека MVEL. В формулах могут использоваться следующие функции:
●	number - генерация случайного целого числа;
●	decimal - генерация случайного десятичного числа;
●	id - генерация случайной последовательности символов (для идентификаторов);
●	dateTime - генерация строки, содержащей дату и время в указанном формате с заданным сдвигом в днях;
●	fileValue - выбор случайного значения из текстового файла;
●	uniqueFlieValue - выбор любого случайного значения из файла кроме того, которое ранее выбиралось из этого файла для генерации текущего сообщения.
Сообщения должны отправляться по плану, описанному в файле с настройками. Пример плана: 100mps/10s;200mps/10s;300mps/20s. Это означает, что первые 10 секунд сообщения должны отправляться со скоростью 100 сообщений в секунду, следующие 10 - 200 сообщений в секунду и последние 20 секунд - 300 сообщений в секунду. Для организации работы по плану нужно использовать шаблон параллельного программирования Producer-Consumer. В данной задаче Producer - поток, генерирующий сообщения согласно плану. Consumer - поток, отправляющий сообщения. Для связи потока-генератора и потока-отправителя должна использоваться BlockingQueue, куда генератор будет складывать сообщения. Нужно посмотреть, какая из реализаций BlockingQueue в Java лучше подходит для задачи отправки по плану.
Статистика по реальной отправке сообщений должна выводиться в лог каждую секунду. Она должна содержать:
●	общее количество отправленных на данный момент сообщений;
●	количество сообщений, отправленных за последнюю секунду.
Для ведения лога можно использовать библиотеку log4j. Статистика должна выводиться с уровнем info. Кроме того, в лог должны попадать сообщений об ошибках. А с уровнем debug должны логгироваться все отправляемые сообщения.
Для сборки проекта необходимо использовать Gradle.
Полезные ссылки
●	Скачать ActiveMQ: -https://activemq.apache.org/components/classic/download/;
●	Как запустить ActiveMQ и зайти в веб-консоль для управления: -https://activemq.apache.org/getting-started#StartingActiveMQStartingActiveMQ;
●	Пример кода для работы с ActiveMQ: -https://activemq.apache.org/hello-world;
●	О библиотеке MVEL: -http://mCompiledTemplate vel.documentnode.com/;
●	Создание простого проекта с Gradle: -https://guides.gradle.org/building-java-applications/;

Пример шаблона сообщения

{1:F01ZYGCGB20XXXX0919155231}{2:O5182138171206@{fileValue('tradeSources')}11167792461712062138N}{4:
:16R:GENL
:20C::SEME//@{id(16)}
:23G:NEWM
:22F::TRTR//TRAD
:16R:LINK
:20C::COMM//SWIFT@{id(11)}
:16S:LINK
:16S:GENL
:16R:CONFDET
:98C::TRAD//@{dateTime('yyyyMMddhhmmss')}
:98A::SETT//@{dateTime('yyyyMMdd',2)}
:90B::DEAL//ACTU/@{fileValue('currencies')}@{decimal(0,99999999, 2)}
:94B::TRAD//EXCH/@{fileValue('tradingVenues')}
:22H::BUSE//BUYI
:22H::PAYM//APMT
:16R:CONFPRTY
:95R::BUYR//@{uniqueFileValue('firms')}
:20C::PROC//Buy Oref
:16S:CONFPRTY
:16R:CONFPRTY
:95R::SELL//@{uniqueFileValue('firms')}
:20C::PROC//Sell Oref
:16S:CONFPRTY
:36B::CONF//UNIT/@{number(1,9999)}
:35B:ISIN @{fileValue('instruments')}
:16R:FIA
:16S:FIA
:16S:CONFDET
:16R:SETDET
:22F::SETR//TRAD
:16S:SETDET
-}{5:{MAC:12345678}{CHK:123456789ABC}}


 
Поля:

TRAD (tradeDate)	Trade date - фактическая дата осуществления сделки.

Требование к полю: дата в формате - 'yyyyMMddhhmmss'.

Пример: 20191201141122.
SETT (settlementDate)	Settlement date - дата завершения конкретной сделки, в эту дату покупатель должен внести оплату за совершение сделки, а продавец должен предоставить финансовые инструменты. Обычно, для акций, settlement date наступает через два дня после осуществления сделки T+2.

Требование к полю: дата в формате - 'yyyyMMdd'.

Пример: 20190601.
currencies	Валюта в которой трейдятся инструменты.

Требование к полю: 3 символа, буквенный код.

Пример: RUB, GBP, AUD.
tradingVenues	Платформы где стороны покупают и продают (осуществляют сделки) инструменты.

Требование к полю: 4 символа, буквенный код.

Пример: CSOM, IART, ETBA.
firms	Кодовое название компании.

Требование к полю: 6 - 11 символов, буквенно-цифровой код.

Пример: PYTEROCHKA1, MAC123, 321PEK.
instruments	Осуществляя операции на финансовом рынке предприятие выбирает соответствующие финансовые инструменты их проведения. Финансовые инструменты представляют собой разнообразные обращающиеся финансовые документы, имеющие денежную стоимость, с помощью которых осуществляются операции на финансовом рынке. Например Акции.

Требование к полю: 12 символов, буквенно-цифровой код.

Пример: OV03054473OV, DMI00T78R55Y, 54P3YT343512


Как работать с MVEL
import org.mvel2.templates.CompiledTemplate;
import org.mvel2.templates.TemplateCompiler;
import org.mvel2.templates.TemplateRuntime;

import java.util.HashMap;
import java.util.Map;

public class MvelTest
{
	public static void main(String[] args)
	{
		Map<String, Object> vars = new HashMap<>();
		vars.put("A", 1);
		vars.put("B", 5);
		CompiledTemplate template = TemplateCompiler.compileTemplate("@{max(A, B)}");
		System.out.println(TemplateRuntime.execute(template, new MvelTest(), vars));
	}
	
	public int max(int a, int b)
	{
		return Math.max(a, b);
	}
}
